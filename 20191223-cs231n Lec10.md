# Recurrent neural networks
![image](https://user-images.githubusercontent.com/56099627/71337998-88925b00-2591-11ea-9e87-60e772815648.png)  
- vanilla neural networks
- image Captioning : image -> sequence of words
- sentiment classification: 감정 분류의 예 sqeuence of words -> sentiment
- machine translation : seq of words -> seq of words
- video classification on frame level

### fixed inputs 을 sequential processing 한 경우
<p align="center"><img width="50%" src="https://user-images.githubusercontent.com/56099627/71338919-fd1ac900-2594-11ea-8cb9-9aa43d0a3e91.png" /></p>  
- conv net에 큰 이미지를 feed 해서 번지수를 classification 하는 방법 대신에 작은 conv을 이용해서 이미지 전체를 sequential 하게 훑어 나가게 된다. 왼쪽에서 오른쪽으로 가면서 숫자를 읽어 나감
### fixed outputs 을 sequential processing 한 경우

### RNN
![image](https://user-images.githubusercontent.com/56099627/71339634-6b608b00-2597-11ea-97d6-35ea75eb2b3b.png)  
- 시간의 흐름에 따라 input벡터를 받게 된다 즉 매 타임스텝마다 input벡더가 rnn으로 입력되게 되는데 rnn은 내부적으로 어떤상태를 가지게 된다 그리고 그 상태를 func(매 타임스텝마디 인풋으로 받는 func)으로 변형해 줄수 있다. rnn도 weight으로 구성이 되며 weight 들이 튜닝됨에 따라서 rnn이 진화되어 나가기 때문에 새로운 iput이 들어올때마다 다른 반응을 보인다. 특정 타임스탭에서의 예측을 원하게 된다(우리가 원하는 결과행동을 갖게함)  
- 주의점: **every time step 마다 동일한 func(,parameter set 등)을 사용한다**  
- 이럴경우, input sequence와 output sequence 사이즈가 매우 크더라도 무관하게 rnn을 적용할 수 있다.

### (vanilla) Recurrent neural network
![image](https://user-images.githubusercontent.com/56099627/71340037-ce065680-2598-11ea-86fc-b62b8489ccc7.png)  
- state가 single hidden vector **h**으로만 구성됨
<p align="center"><img width="50%" src="https://user-images.githubusercontent.com/56099627/71340452-402b6b00-259a-11ea-8b88-50e730790c44.png" /></p>  
-예측값과 타겟값 사이 오차(sofmax 함수를 통해 오차 구함)를 구하고 backpropagatioin을 해주어 gradient을 통해 학습해 나간다.  
- every time step 마다 동일한 parameter set을 사용해야 하므로 W_hy, W_hh, W_xh가 매 단계에서 사용하는 피라미터가 동일하다.  
### min-char-rnn.py (RNN code) 
<div class="colorscripter-code" style="color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div><div style="line-height:130%">11</div><div style="line-height:130%">12</div><div style="line-height:130%">13</div><div style="line-height:130%">14</div><div style="line-height:130%">15</div><div style="line-height:130%">16</div><div style="line-height:130%">17</div><div style="line-height:130%">18</div><div style="line-height:130%">19</div><div style="line-height:130%">20</div><div style="line-height:130%">21</div><div style="line-height:130%">22</div><div style="line-height:130%">23</div><div style="line-height:130%">24</div><div style="line-height:130%">25</div><div style="line-height:130%">26</div><div style="line-height:130%">27</div><div style="line-height:130%">28</div><div style="line-height:130%">29</div><div style="line-height:130%">30</div><div style="line-height:130%">31</div><div style="line-height:130%">32</div><div style="line-height:130%">33</div><div style="line-height:130%">34</div><div style="line-height:130%">35</div><div style="line-height:130%">36</div><div style="line-height:130%">37</div><div style="line-height:130%">38</div><div style="line-height:130%">39</div><div style="line-height:130%">40</div><div style="line-height:130%">41</div><div style="line-height:130%">42</div><div style="line-height:130%">43</div><div style="line-height:130%">44</div><div style="line-height:130%">45</div><div style="line-height:130%">46</div><div style="line-height:130%">47</div><div style="line-height:130%">48</div><div style="line-height:130%">49</div><div style="line-height:130%">50</div><div style="line-height:130%">51</div><div style="line-height:130%">52</div><div style="line-height:130%">53</div><div style="line-height:130%">54</div><div style="line-height:130%">55</div><div style="line-height:130%">56</div><div style="line-height:130%">57</div><div style="line-height:130%">58</div><div style="line-height:130%">59</div><div style="line-height:130%">60</div><div style="line-height:130%">61</div><div style="line-height:130%">62</div><div style="line-height:130%">63</div><div style="line-height:130%">64</div><div style="line-height:130%">65</div><div style="line-height:130%">66</div><div style="line-height:130%">67</div><div style="line-height:130%">68</div><div style="line-height:130%">69</div><div style="line-height:130%">70</div><div style="line-height:130%">71</div><div style="line-height:130%">72</div><div style="line-height:130%">73</div><div style="line-height:130%">74</div><div style="line-height:130%">75</div><div style="line-height:130%">76</div><div style="line-height:130%">77</div><div style="line-height:130%">78</div><div style="line-height:130%">79</div><div style="line-height:130%">80</div><div style="line-height:130%">81</div><div style="line-height:130%">82</div><div style="line-height:130%">83</div><div style="line-height:130%">84</div><div style="line-height:130%">85</div><div style="line-height:130%">86</div><div style="line-height:130%">87</div><div style="line-height:130%">88</div><div style="line-height:130%">89</div><div style="line-height:130%">90</div><div style="line-height:130%">91</div><div style="line-height:130%">92</div><div style="line-height:130%">93</div><div style="line-height:130%">94</div><div style="line-height:130%">95</div><div style="line-height:130%">96</div><div style="line-height:130%">97</div><div style="line-height:130%">98</div><div style="line-height:130%">99</div><div style="line-height:130%">100</div><div style="line-height:130%">101</div><div style="line-height:130%">102</div><div style="line-height:130%">103</div><div style="line-height:130%">104</div><div style="line-height:130%">105</div><div style="line-height:130%">106</div><div style="line-height:130%">107</div><div style="line-height:130%">108</div><div style="line-height:130%">109</div><div style="line-height:130%">110</div><div style="line-height:130%">111</div><div style="line-height:130%">112</div><div style="line-height:130%">113</div><div style="line-height:130%">114</div><div style="line-height:130%">115</div><div style="line-height:130%">116</div><div style="line-height:130%">117</div><div style="line-height:130%">118</div><div style="line-height:130%">119</div><div style="line-height:130%">120</div><div style="line-height:130%">121</div><div style="line-height:130%">122</div><div style="line-height:130%">123</div><div style="line-height:130%">124</div><div style="line-height:130%">125</div><div style="line-height:130%">126</div><div style="line-height:130%">127</div><div style="line-height:130%">128</div><div style="line-height:130%">129</div><div style="line-height:130%">130</div><div style="line-height:130%">131</div><div style="line-height:130%">132</div><div style="line-height:130%">133</div><div style="line-height:130%">134</div><div style="line-height:130%">135</div><div style="line-height:130%">136</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">""</span><span style="color:#63a35c">"</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">Minimal&nbsp;character-level&nbsp;Vanilla&nbsp;RNN&nbsp;model.&nbsp;Written&nbsp;by&nbsp;Andrej&nbsp;Karpathy&nbsp;(@karpathy)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">BSD&nbsp;license</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">python&nbsp;3에서&nbsp;실행&nbsp;가능하도록&nbsp;수정,&nbsp;한글&nbsp;해설&nbsp;추가</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">"</span><span style="color:#63a35c">""</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">import</span>&nbsp;numpy&nbsp;as&nbsp;np</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;데이터를&nbsp;불러오고,&nbsp;글자-벡터&nbsp;간&nbsp;상호&nbsp;변환&nbsp;매핑&nbsp;준비&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">data&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#066de2">open</span>(<span style="color:#63a35c">'input.txt'</span>,&nbsp;<span style="color:#63a35c">'r'</span>).read()&nbsp;<span style="color:#999999">#&nbsp;텍스트&nbsp;파일&nbsp;로드</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">chars&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;list(set(data))&nbsp;<span style="color:#999999">#&nbsp;텍스트&nbsp;파일에서&nbsp;고유한&nbsp;문자&nbsp;추출&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">data_size,&nbsp;vocab_size&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#066de2">len</span>(data),&nbsp;<span style="color:#066de2">len</span>(chars)</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#066de2">print</span>(<span style="color:#63a35c">'데이터는&nbsp;{}개의&nbsp;글자로&nbsp;되어&nbsp;있고,&nbsp;{}개의&nbsp;고유한&nbsp;문자가&nbsp;있습니다.'</span>.<span style="color:#066de2">format</span>(data_size,&nbsp;vocab_size))</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#066de2">print</span>(repr(<span style="color:#63a35c">''</span>.join(sorted(<span style="color:#066de2">str</span>(x)&nbsp;<span style="color:#a71d5d">for</span>&nbsp;x&nbsp;<span style="color:#a71d5d">in</span>&nbsp;chars))))&nbsp;<span style="color:#999999">#&nbsp;추출된&nbsp;고유한&nbsp;글자들을&nbsp;알파벳&nbsp;순서대로&nbsp;출력</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;고유한&nbsp;글자들(a,b,c,d...)을&nbsp;숫자(1,2,3,4...)에&nbsp;매핑하는&nbsp;사전과,&nbsp;반대&nbsp;기능을&nbsp;수행하는&nbsp;사전을&nbsp;만듦</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">char_to_ix&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;{&nbsp;ch:i&nbsp;<span style="color:#a71d5d">for</span>&nbsp;i,ch&nbsp;<span style="color:#a71d5d">in</span>&nbsp;enumerate(chars)&nbsp;}</div><div style="padding:0 6px; white-space:pre; line-height:130%">ix_to_char&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;{&nbsp;i:ch&nbsp;<span style="color:#a71d5d">for</span>&nbsp;i,ch&nbsp;<span style="color:#a71d5d">in</span>&nbsp;enumerate(chars)&nbsp;}</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;하이퍼파라미터&nbsp;설정</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">hidden_size&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">100</span>&nbsp;<span style="color:#999999">#&nbsp;hidden&nbsp;state의&nbsp;뉴런&nbsp;갯수</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">seq_length&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">25</span>&nbsp;<span style="color:#999999">#&nbsp;학습시킬&nbsp;때&nbsp;한번에&nbsp;불러올&nbsp;글자&nbsp;수이자&nbsp;RNN을&nbsp;펼쳤을&nbsp;때의&nbsp;단계&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">learning_rate&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;1e<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span><span style="color:#0099cc">1</span>&nbsp;<span style="color:#999999">#&nbsp;학습속도,&nbsp;가중치를&nbsp;조정할&nbsp;때&nbsp;이동할&nbsp;간격</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;모델&nbsp;파라미터&nbsp;초기화(가중치는&nbsp;작은&nbsp;수의&nbsp;랜덤한&nbsp;값,&nbsp;bias는&nbsp;0으로&nbsp;초기화)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">Wxh&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.random.randn(hidden_size,&nbsp;vocab_size)<span style="color:#0086b3"></span><span style="color:#a71d5d">*</span><span style="color:#0099cc">0.</span><span style="color:#0099cc">01</span>&nbsp;<span style="color:#999999">#&nbsp;input&nbsp;to&nbsp;hidden&nbsp;(100,25)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">Whh&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.random.randn(hidden_size,&nbsp;hidden_size)<span style="color:#0086b3"></span><span style="color:#a71d5d">*</span><span style="color:#0099cc">0.</span><span style="color:#0099cc">01</span>&nbsp;<span style="color:#999999">#&nbsp;hidden&nbsp;to&nbsp;hidden&nbsp;(100,100)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">Why&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.random.randn(vocab_size,&nbsp;hidden_size)<span style="color:#0086b3"></span><span style="color:#a71d5d">*</span><span style="color:#0099cc">0.</span><span style="color:#0099cc">01</span>&nbsp;<span style="color:#999999">#&nbsp;hidden&nbsp;to&nbsp;output&nbsp;(25,100)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">bh&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros((hidden_size,&nbsp;<span style="color:#0099cc">1</span>))&nbsp;<span style="color:#999999">#&nbsp;hidden&nbsp;bias&nbsp;(100,1)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">by&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros((vocab_size,&nbsp;<span style="color:#0099cc">1</span>))&nbsp;<span style="color:#999999">#&nbsp;output&nbsp;bias&nbsp;(25,1)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">def</span>&nbsp;lossFun(inputs,&nbsp;targets,&nbsp;hprev):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#63a35c">""</span><span style="color:#63a35c">"</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;inputs,targets&nbsp;are&nbsp;both&nbsp;list&nbsp;of&nbsp;integers.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;hprev&nbsp;is&nbsp;Hx1&nbsp;array&nbsp;of&nbsp;initial&nbsp;hidden&nbsp;state</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;returns&nbsp;the&nbsp;loss,&nbsp;gradients&nbsp;on&nbsp;model&nbsp;parameters,&nbsp;and&nbsp;last&nbsp;hidden&nbsp;state</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;inputs,&nbsp;targets는&nbsp;모두&nbsp;숫자&nbsp;인덱스의&nbsp;리스트이다.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;hprev는&nbsp;H(hidden_size)x1의&nbsp;array,&nbsp;이전&nbsp;학습에서&nbsp;반환한&nbsp;마지막&nbsp;hidden&nbsp;state임</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;forward&nbsp;pass(손실값&nbsp;계산),&nbsp;backward&nbsp;pass(그래디언트&nbsp;계산)를&nbsp;모두&nbsp;수행한&nbsp;후&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;손실값,&nbsp;각각의&nbsp;가중치에&nbsp;대한&nbsp;그래디언트,&nbsp;그리고&nbsp;다음&nbsp;반복&nbsp;때&nbsp;사용할&nbsp;마지막&nbsp;hidden&nbsp;state를&nbsp;반환함.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;"</span><span style="color:#63a35c">""</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;xs,&nbsp;hs,&nbsp;ys,&nbsp;ps&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;{},&nbsp;{},&nbsp;{},&nbsp;{}</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;hs[<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span><span style="color:#0099cc">1</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.copy(hprev)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;loss&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">0</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#999999">#&nbsp;forward&nbsp;pass(손실값&nbsp;계산)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">for</span>&nbsp;t&nbsp;<span style="color:#a71d5d">in</span>&nbsp;<span style="color:#066de2">range</span>(<span style="color:#066de2">len</span>(inputs)):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;xs[t]&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros((vocab_size,<span style="color:#0099cc">1</span>))&nbsp;<span style="color:#999999">#&nbsp;1-of-k(one-hot)&nbsp;형태로&nbsp;변환.&nbsp;모든&nbsp;값이&nbsp;0인&nbsp;array&nbsp;준비</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;xs[t][inputs[t]]&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">1</span>&nbsp;<span style="color:#999999">#&nbsp;해당하는&nbsp;글자에만&nbsp;값을&nbsp;1로&nbsp;설정&nbsp;-&nbsp;[0,&nbsp;...,&nbsp;0,&nbsp;1,&nbsp;0,&nbsp;...,&nbsp;0]</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;hs[t]&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.tanh(np.dot(Wxh,&nbsp;xs[t])&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>&nbsp;np.dot(Whh,&nbsp;hs[t<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span><span style="color:#0099cc">1</span>])&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>&nbsp;bh)&nbsp;<span style="color:#999999">#&nbsp;hidden&nbsp;state&nbsp;업데이트</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;ys[t]&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.dot(Why,&nbsp;hs[t])&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>&nbsp;by&nbsp;<span style="color:#999999">#&nbsp;다음&nbsp;글자가&nbsp;어떤&nbsp;글자가&nbsp;나올지에&nbsp;가능성을&nbsp;표시한&nbsp;array(정규화되지&nbsp;않음)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;ps[t]&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.exp(ys[t])&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">/</span>&nbsp;np.sum(np.exp(ys[t]))&nbsp;<span style="color:#999999">#&nbsp;softmax로&nbsp;각&nbsp;글자의&nbsp;등장&nbsp;가능성을&nbsp;확률로&nbsp;표시</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;loss&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span>np.log(ps[t][targets[t],<span style="color:#0099cc">0</span>])&nbsp;<span style="color:#999999">#&nbsp;cross-entropy를&nbsp;이용하여&nbsp;정답과&nbsp;비교하여&nbsp;손실값&nbsp;판정</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#999999">#&nbsp;backward&nbsp;pass(그래디언트&nbsp;계산)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#999999">#&nbsp;변수&nbsp;초기화</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;dWxh,&nbsp;dWhh,&nbsp;dWhy&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros_like(Wxh),&nbsp;np.zeros_like(Whh),&nbsp;np.zeros_like(Why)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;dbh,&nbsp;dby&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros_like(bh),&nbsp;np.zeros_like(by)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;dhnext&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros_like(hs[<span style="color:#0099cc">0</span>])</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">for</span>&nbsp;t&nbsp;<span style="color:#a71d5d">in</span>&nbsp;reversed(<span style="color:#066de2">range</span>(<span style="color:#066de2">len</span>(inputs))):&nbsp;<span style="color:#999999">#forward&nbsp;pass의&nbsp;과정을&nbsp;반대로&nbsp;진행(t=24부터&nbsp;시작)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;dy&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.copy(ps[t])</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;dy[targets[t]]&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">1</span>&nbsp;<span style="color:#999999">#&nbsp;y의&nbsp;그래디언트&nbsp;계산,&nbsp;softmax&nbsp;함수의&nbsp;그래디언트&nbsp;계산</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;dWhy&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.dot(dy,&nbsp;hs[t].T)&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;dby&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;dy</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;dh&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.dot(Why.T,&nbsp;dy)&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>&nbsp;dhnext&nbsp;<span style="color:#999999">#&nbsp;loss에서&nbsp;사용된&nbsp;h와&nbsp;h를&nbsp;업데이트한&nbsp;계산의&nbsp;그래디언트&nbsp;값을&nbsp;더함</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;dhraw&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;(<span style="color:#0099cc">1</span>&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span>&nbsp;hs[t]&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">*</span>&nbsp;hs[t])&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">*</span>&nbsp;dh&nbsp;<span style="color:#999999">#&nbsp;tanh&nbsp;역전파</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;dbh&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;dhraw</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;dWxh&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.dot(dhraw,&nbsp;xs[t].T)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;dWhh&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.dot(dhraw,&nbsp;hs[t<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span><span style="color:#0099cc">1</span>].T)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;dhnext&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.dot(Whh.T,&nbsp;dhraw)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">for</span>&nbsp;dparam&nbsp;<span style="color:#a71d5d">in</span>&nbsp;[dWxh,&nbsp;dWhh,&nbsp;dWhy,&nbsp;dbh,&nbsp;dby]:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;np.clip(dparam,&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span><span style="color:#0099cc">5</span>,&nbsp;<span style="color:#0099cc">5</span>,&nbsp;out<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>dparam)&nbsp;<span style="color:#999999">#&nbsp;그래디언트&nbsp;발산&nbsp;방지</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">return</span>&nbsp;loss,&nbsp;dWxh,&nbsp;dWhh,&nbsp;dWhy,&nbsp;dbh,&nbsp;dby,&nbsp;hs[<span style="color:#066de2">len</span>(inputs)<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span><span style="color:#0099cc">1</span>]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">def</span>&nbsp;sample(h,&nbsp;seed_ix,&nbsp;n):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#63a35c">""</span><span style="color:#63a35c">"&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;sample&nbsp;a&nbsp;sequence&nbsp;of&nbsp;integers&nbsp;from&nbsp;the&nbsp;model&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;h&nbsp;is&nbsp;memory&nbsp;state,&nbsp;seed_ix&nbsp;is&nbsp;seed&nbsp;letter&nbsp;for&nbsp;first&nbsp;time&nbsp;step</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;모델에서&nbsp;지정된&nbsp;글자&nbsp;수(n)&nbsp;만큼의&nbsp;글자(숫자의&nbsp;리스트)를&nbsp;출력</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;h&nbsp;는&nbsp;hidden&nbsp;state,&nbsp;seed_ix는&nbsp;주어진&nbsp;첫번째&nbsp;글자</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#63a35c">&nbsp;&nbsp;"</span><span style="color:#63a35c">""</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;x&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros((vocab_size,&nbsp;<span style="color:#0099cc">1</span>))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;x[seed_ix]&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">1</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;ixes&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;[]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">for</span>&nbsp;t&nbsp;<span style="color:#a71d5d">in</span>&nbsp;<span style="color:#066de2">range</span>(n):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;forward&nbsp;pass&nbsp;수행</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;h&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.tanh(np.dot(Wxh,&nbsp;x)&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>&nbsp;np.dot(Whh,&nbsp;h)&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>&nbsp;bh)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.dot(Why,&nbsp;h)&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>&nbsp;by</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.exp(y)&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">/</span>&nbsp;np.sum(np.exp(y))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;샘플링.&nbsp;임의성을&nbsp;부여하기&nbsp;위해&nbsp;argmax대신&nbsp;array&nbsp;p에서&nbsp;주어진&nbsp;확률에&nbsp;의해&nbsp;하나의&nbsp;문자를&nbsp;선택</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;ix&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.random.choice(<span style="color:#066de2">range</span>(vocab_size),&nbsp;p<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>p.ravel())</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;다음&nbsp;글자&nbsp;추론을&nbsp;위해&nbsp;샘플링&nbsp;된&nbsp;글자를&nbsp;다음&nbsp;입력으로&nbsp;사용&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros((vocab_size,&nbsp;<span style="color:#0099cc">1</span>))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;x[ix]&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">1</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;결과값&nbsp;리스트에&nbsp;추가</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;ixes.append(ix)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">return</span>&nbsp;ixes</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">n,&nbsp;p&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">0</span>,&nbsp;<span style="color:#0099cc">0</span>&nbsp;<span style="color:#999999">#&nbsp;&nbsp;반복&nbsp;회수(n)&nbsp;및&nbsp;입력&nbsp;데이터(p)&nbsp;위치&nbsp;초기화&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;Adagrad&nbsp;알고리즘에&nbsp;사용되는&nbsp;메모리&nbsp;변수&nbsp;초기화</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">mWxh,&nbsp;mWhh,&nbsp;mWhy&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros_like(Wxh),&nbsp;np.zeros_like(Whh),&nbsp;np.zeros_like(Why)</div><div style="padding:0 6px; white-space:pre; line-height:130%">mbh,&nbsp;mby&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros_like(bh),&nbsp;np.zeros_like(by)&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">smooth_loss&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span>np.log(<span style="color:#0099cc">1.</span><span style="color:#0099cc">0</span><span style="color:#a71d5d">/</span>vocab_size)<span style="color:#0086b3"></span><span style="color:#a71d5d">*</span>seq_length&nbsp;<span style="color:#999999">#&nbsp;학습이&nbsp;이루어지기&nbsp;전의&nbsp;손실값</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">while</span>&nbsp;True:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#999999">#&nbsp;입력데이터&nbsp;준비,&nbsp;텍스트의&nbsp;맨&nbsp;앞쪽부터&nbsp;seq_length만큼씩&nbsp;데이터를&nbsp;준비</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#999999">#&nbsp;데이터를&nbsp;모두&nbsp;사용하면&nbsp;입력&nbsp;데이터의&nbsp;맨&nbsp;처음으로&nbsp;이동</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">if</span>&nbsp;p<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>seq_length<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0099cc">1</span>&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">&gt;</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#066de2">len</span>(data)&nbsp;<span style="color:#a71d5d">or</span>&nbsp;n&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">0</span>:&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;hprev&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.zeros((hidden_size,<span style="color:#0099cc">1</span>))&nbsp;<span style="color:#999999">#&nbsp;RNN&nbsp;메모리&nbsp;초기화</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">0</span>&nbsp;<span style="color:#999999">#&nbsp;입력&nbsp;데이터의&nbsp;맨&nbsp;처음으로&nbsp;이동</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#999999">#&nbsp;입력(p~p+24번째&nbsp;글자),&nbsp;목표(p+1~p+25번째&nbsp;글자)&nbsp;데이터를&nbsp;준비&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;inputs&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;[char_to_ix[ch]&nbsp;<span style="color:#a71d5d">for</span>&nbsp;ch&nbsp;<span style="color:#a71d5d">in</span>&nbsp;data[p:p<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>seq_length]]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;targets&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;[char_to_ix[ch]&nbsp;<span style="color:#a71d5d">for</span>&nbsp;ch&nbsp;<span style="color:#a71d5d">in</span>&nbsp;data[p<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0099cc">1</span>:p<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>seq_length<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0099cc">1</span>]]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#999999">#&nbsp;학습을&nbsp;100번&nbsp;반복할&nbsp;때마다&nbsp;학습&nbsp;결과를&nbsp;출력</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">if</span>&nbsp;n&nbsp;%&nbsp;<span style="color:#0099cc">100</span>&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">0</span>:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;sample_ix&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;sample(hprev,&nbsp;inputs[<span style="color:#0099cc">0</span>],&nbsp;<span style="color:#0099cc">200</span>)&nbsp;<span style="color:#999999">#지금까지&nbsp;학습한&nbsp;RNN을&nbsp;이용하여&nbsp;숫자의&nbsp;리스트를&nbsp;출력</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;txt&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#63a35c">''</span>.join(ix_to_char[ix]&nbsp;<span style="color:#a71d5d">for</span>&nbsp;ix&nbsp;<span style="color:#a71d5d">in</span>&nbsp;sample_ix)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#066de2">print</span>(<span style="color:#63a35c">'----\n&nbsp;%s&nbsp;\n----'</span>&nbsp;%&nbsp;(txt,&nbsp;))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#999999">#&nbsp;손실함수에서&nbsp;손실값과&nbsp;그래디언트를&nbsp;함께&nbsp;계산</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;loss,&nbsp;dWxh,&nbsp;dWhh,&nbsp;dWhy,&nbsp;dbh,&nbsp;dby,&nbsp;hprev&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;lossFun(inputs,&nbsp;targets,&nbsp;hprev)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;smooth_loss&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;smooth_loss&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">*</span>&nbsp;<span style="color:#0099cc">0.</span><span style="color:#0099cc">999</span>&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>&nbsp;loss&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">*</span>&nbsp;<span style="color:#0099cc">0.</span><span style="color:#0099cc">001</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">if</span>&nbsp;n&nbsp;%&nbsp;<span style="color:#0099cc">100</span>&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">0</span>:&nbsp;<span style="color:#066de2">print</span>(<span style="color:#63a35c">'iter&nbsp;%d,&nbsp;loss:&nbsp;%f'</span>&nbsp;%&nbsp;(n,&nbsp;smooth_loss))&nbsp;<span style="color:#999999">#&nbsp;반복횟수,&nbsp;손실&nbsp;출력</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Adagrad&nbsp;방식으로&nbsp;파라미터&nbsp;업데이트</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;<span style="color:#a71d5d">for</span>&nbsp;param,&nbsp;dparam,&nbsp;mem&nbsp;<span style="color:#a71d5d">in</span>&nbsp;zip([Wxh,&nbsp;&nbsp;Whh,&nbsp;&nbsp;Why,&nbsp;&nbsp;bh,&nbsp;&nbsp;by],&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;가중치</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[dWxh,&nbsp;dWhh,&nbsp;dWhy,&nbsp;dbh,&nbsp;dby],&nbsp;&nbsp;<span style="color:#999999">#&nbsp;그래디언트</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[mWxh,&nbsp;mWhh,&nbsp;mWhy,&nbsp;mbh,&nbsp;mby]):&nbsp;<span style="color:#999999">#&nbsp;메모리&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;mem&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;dparam&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">*</span>&nbsp;dparam</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;param&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span>learning_rate&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">*</span>&nbsp;dparam&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">/</span>&nbsp;np.sqrt(mem&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span>&nbsp;1e<span style="color:#0086b3"></span><span style="color:#a71d5d">-</span><span style="color:#0099cc">8</span>)&nbsp;<span style="color:#999999">#&nbsp;실제&nbsp;파라메터&nbsp;업데이트</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;p&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;seq_length&nbsp;<span style="color:#999999">#&nbsp;데이터&nbsp;포인터를&nbsp;seq_length만큼&nbsp;우측으로&nbsp;이동</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;n&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">+</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">1</span>&nbsp;<span style="color:#999999">#&nbsp;반복횟수&nbsp;카운터</span></div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#e5e5e5text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#e5e5e5;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

### Image captionning
![image](https://user-images.githubusercontent.com/56099627/71342316-bb435000-259f-11ea-96fb-afd1d9d16359.png)
- 이것은 2개의 모듈으로 이뤄짐 (1번 모듈: conv net, 2번 모듈: rnn) 
  - cnn 에선 이미지를 처리 해줌
  - rnn 에선 sequence 처리 해줌
![image](https://user-images.githubusercontent.com/56099627/71343585-a49ef800-25a3-11ea-9574-8f96401f43e9.png)  
- image captionning 예
### Image captionning의 다음단계는 rnn with attention ?  
![image](https://user-images.githubusercontent.com/56099627/71343861-66560880-25a4-11ea-9982-cad4382cdf84.png)  
- rnn은 이미지를 한번만 보고 추출하는 반면에 rnn with attention은 이미지의 특정 부분을 보고 그 부분에 적합한 단어를 추출하고 또 이미지의 특정 부분을 보고 그 부분에 적합한 단어를 추출함

### LSTM
![image](https://user-images.githubusercontent.com/56099627/71344434-e335b200-25a5-11ea-9574-b3f2dc608cea.png)  
- 큰 틀에서는 rnn과 동일함. lstm에서는 cell state, hidden state (2개)가 존재함
- i: input gate-sigmoid, f: forget gate-sigmoid, o: output gate-sigmoid, g: -tanh(-1 ~ 1범위)
- 현재의 상태(cellstate)가 이전의 상태를 얼마나 잊을 것인가 (만약에 f가 1이라면 이전 상태 정보를 다 가져올 것이고, 만약에 f가 0이라면 이전 상태 정보를 전혀 가져오지 않을 것임) + 얼마나 더해줄 것인지를 g 가 정함(인풋(0~1)에 g(-1 ~ 1))
- cell state를 tanh의 인자에 넣어줌 그런 후, squeeze을 시킨 후, output gate에 넣어줌 (현재상태를 아웃풋에 넣어줌으로서 인헤서 hidden state을 구하게 됨) : 노란색(cell state)에서 구한 후, 녹색(hidden state)으로 전달 하여 hidden state vector 구해짐
![image](https://user-images.githubusercontent.com/56099627/71346015-37db2c00-25aa-11ea-8ce5-631699f47f84.png)  
- lstm 반복 
- cell state가 flow 하면서 forget, input, output들이 조금씩 추가되어 변화한다 중요한 포인트임
![image](https://user-images.githubusercontent.com/56099627/71346869-517d7300-25ac-11ea-99b0-4e6253121ef2.png)  
- rnn은 잘 쓰지 않는데 이유는 gradinet vanishing 문제가 발생함. 그래서 gradient clipping을 쓰지만 효과적이진 않음. LSTM으로 이문제를 해결 가능함. LSTM에선 + 으로 연결되어 있기때문에 +은 distribute 역할을 해서~ vanishing되지 않음(단, forget gate에서 0을 주게 된다면 vanishing 되므로 forget gate에 아주 작은 bias 값을 주어 vanishing을 방지한다. 진행이 멈추는 것을 방지한다)





  
참고  
[1] http://cs231n.stanford.edu/2016/syllabus.html, (설명) Andu song  
[2] https://www.youtube.com/watch?v=2ngo9-YCxzY&t=1623s, cs231n 10강 RNN, LSTM  
[3] https://gist.github.com/MinjeJeon/8f50693f0a986419ab2dda35753acb1f, MinjeJeon/min-char-rnn.py 
